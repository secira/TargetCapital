{% extends "admin/base.html" %}

{% block title %}Add Daily Signal - Admin{% endblock %}

{% block page_title %}Add New Daily Signal{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-lg-10">
        <div class="card admin-card">
            <div class="card-header">
                <i class="fas fa-plus-circle me-2"></i>Create New Trading Signal
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('admin.add_daily_signal') }}" id="signalForm">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Signal Date <span class="text-danger">*</span></label>
                            <input type="date" name="signal_date" class="form-control" value="{{ today }}" required>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Asset Type <span class="text-danger">*</span></label>
                            <select name="asset_type" id="assetType" class="form-select" required onchange="updateFormFields()">
                                <option value="">Select Asset Type</option>
                                <option value="NIFTY">Nifty</option>
                                <option value="BANKNIFTY">BankNifty</option>
                                <option value="SENSEX">Sensex</option>
                                <option value="FINNIFTY">FinNifty</option>
                                <option value="STOCK">Stock</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Instrument Type <span class="text-danger">*</span></label>
                            <select name="sub_type" id="subType" class="form-select" required onchange="updateFormFields()">
                                <option value="">Select Type</option>
                                <option value="CE">Call Option (CE)</option>
                                <option value="PE">Put Option (PE)</option>
                                <option value="FUT">Futures</option>
                                <option value="EQ">Equity</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="row" id="stockSymbolRow" style="display: none;">
                        <div class="col-md-6 mb-3">
                            <label class="form-label">Stock Symbol <span class="text-danger">*</span></label>
                            <input type="text" name="symbol" id="symbol" class="form-control" placeholder="e.g., RELIANCE, TCS, INFY">
                        </div>
                    </div>
                    
                    <div class="row" id="optionFields" style="display: none;">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Strike Price <span class="text-danger">*</span></label>
                            <input type="number" step="0.05" name="strike_price" id="strikePrice" class="form-control" placeholder="e.g., 24500">
                        </div>
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Strike Type</label>
                            <select name="strike_type" class="form-select">
                                <option value="">Select</option>
                                <option value="ATM">ATM (At The Money)</option>
                                <option value="ITM">ITM (In The Money)</option>
                                <option value="OTM">OTM (Out of The Money)</option>
                            </select>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Trade Duration <span class="text-danger">*</span></label>
                            <select name="trade_duration" class="form-select" required>
                                <option value="">Select Duration</option>
                                <option value="DAY">Day Trading (Intraday)</option>
                                <option value="WEEK">Swing Trading (1-5 Days)</option>
                                <option value="MONTH">Long Term (1+ Month)</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Action <span class="text-danger">*</span></label>
                            <select name="action" class="form-select" required>
                                <option value="BUY" selected>BUY</option>
                                <option value="SELL">SELL</option>
                            </select>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Risk Level</label>
                            <select name="risk_level" class="form-select">
                                <option value="LOW">Low Risk</option>
                                <option value="MEDIUM" selected>Medium Risk</option>
                                <option value="HIGH">High Risk</option>
                            </select>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    <h5 class="mb-3"><i class="fas fa-chart-area me-2"></i>Price Levels</h5>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Entry Price (Buy Above) <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">₹</span>
                                <input type="number" step="0.05" name="buy_above" class="form-control" required placeholder="Entry price">
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Stop Loss <span class="text-danger">*</span></label>
                            <div class="input-group">
                                <span class="input-group-text">₹</span>
                                <input type="number" step="0.05" name="stop_loss" class="form-control" required placeholder="Stop loss">
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Target 1</label>
                            <div class="input-group">
                                <span class="input-group-text">₹</span>
                                <input type="number" step="0.05" name="target_1" class="form-control" placeholder="First target">
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Target 2</label>
                            <div class="input-group">
                                <span class="input-group-text">₹</span>
                                <input type="number" step="0.05" name="target_2" class="form-control" placeholder="Second target">
                            </div>
                        </div>
                        
                        <div class="col-md-4 mb-3">
                            <label class="form-label">Target 3</label>
                            <div class="input-group">
                                <span class="input-group-text">₹</span>
                                <input type="number" step="0.05" name="target_3" class="form-control" placeholder="Third target (optional)">
                            </div>
                        </div>
                    </div>
                    
                    <hr class="my-4">
                    
                    <div class="row">
                        <div class="col-12 mb-3">
                            <label class="form-label">Notes / Analysis</label>
                            <textarea name="notes" class="form-control" rows="3" placeholder="Additional notes or analysis for this signal..."></textarea>
                        </div>
                    </div>
                    
                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('admin.daily_signals') }}" class="btn btn-outline-secondary">
                            <i class="fas fa-arrow-left me-2"></i>Back to Signals
                        </a>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save me-2"></i>Create Signal
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function updateFormFields() {
    const assetType = document.getElementById('assetType').value;
    const subType = document.getElementById('subType').value;
    const stockSymbolRow = document.getElementById('stockSymbolRow');
    const optionFields = document.getElementById('optionFields');
    const symbolInput = document.getElementById('symbol');
    const strikePriceInput = document.getElementById('strikePrice');
    
    if (assetType === 'STOCK') {
        stockSymbolRow.style.display = 'flex';
        symbolInput.required = true;
    } else {
        stockSymbolRow.style.display = 'none';
        symbolInput.required = false;
    }
    
    if (subType === 'CE' || subType === 'PE') {
        optionFields.style.display = 'flex';
        strikePriceInput.required = true;
    } else {
        optionFields.style.display = 'none';
        strikePriceInput.required = false;
    }
}
</script>
{% endblock %}
