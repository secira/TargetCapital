{% extends "base.html" %}

{% block title %}Trade Now - tCapital Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 px-0">
            {% include 'dashboard/sidebar.html' %}
        </div>
        
        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2"><i class="fas fa-bolt me-2"></i>Smart Trading Signals</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-success btn-sm" onclick="executeAutoTrade()">
                            <i class="fas fa-play me-1"></i>Auto Trade
                        </button>
                        <button type="button" class="btn btn-outline-primary btn-sm" onclick="refreshSignals()">
                            <i class="fas fa-sync-alt me-1"></i>Refresh
                        </button>
                    </div>
                </div>
            </div>

            <!-- Trading Overview Cards -->
            <div class="row mb-4">
                <div class="col-md-3">
                    <div class="card bg-white shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted">Active Signals</h6>
                                    <h5 class="mb-0 text-dark" id="activeSignals">18</h5>
                                    <small class="text-muted">Ready to trade</small>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-signal fa-2x text-success"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-white shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted">Success Rate</h6>
                                    <h5 class="mb-0 text-dark" id="successRate">82.5%</h5>
                                    <small class="text-muted">Last 50 trades</small>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-trophy fa-2x text-primary"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-white shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted">Avg Return</h6>
                                    <h5 class="mb-0 text-dark" id="avgReturn">+4.2%</h5>
                                    <small class="text-muted">Per trade</small>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-percentage fa-2x text-warning"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-3">
                    <div class="card bg-white shadow-sm border-0">
                        <div class="card-body">
                            <div class="d-flex justify-content-between">
                                <div>
                                    <h6 class="card-title text-muted">Available Capital</h6>
                                    <h5 class="mb-0 text-dark" id="availableCapital">₹2,45,000</h5>
                                    <small class="text-muted">For trading</small>
                                </div>
                                <div class="align-self-center">
                                    <i class="fas fa-wallet fa-2x text-info"></i>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Smart Signal Controls -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-cogs me-2"></i>Smart Trading Configuration</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Trading Mode</label>
                                        <select class="form-select" id="tradingMode">
                                            <option value="manual">Manual Execution</option>
                                            <option value="semi-auto">Semi-Automatic</option>
                                            <option value="auto">Fully Automatic</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Risk Level</label>
                                        <select class="form-select" id="riskLevel">
                                            <option value="low">Conservative</option>
                                            <option value="medium" selected>Moderate</option>
                                            <option value="high">Aggressive</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Max Position Size</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="maxPositionSize" value="50000" min="10000" max="500000">
                                            <span class="input-group-text">₹</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-3">
                                    <div class="mb-3">
                                        <label class="form-label">Stop Loss %</label>
                                        <div class="input-group">
                                            <input type="number" class="form-control" id="stopLoss" value="3" min="1" max="10" step="0.5">
                                            <span class="input-group-text">%</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="enableNotifications" checked>
                                        <label class="form-check-label" for="enableNotifications">
                                            Enable trade notifications
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="enableAutoStopLoss" checked>
                                        <label class="form-check-label" for="enableAutoStopLoss">
                                            Auto set stop-loss orders
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Live Trading Signals -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-lightning me-2"></i>Live Trading Signals</h5>
                            <div>
                                <span class="badge bg-success me-2">Live</span>
                                <span class="text-muted small">Updated: 2 min ago</span>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="table-responsive">
                                <table class="table table-hover">
                                    <thead class="table-light">
                                        <tr>
                                            <th>Signal</th>
                                            <th>Symbol</th>
                                            <th>Entry Price</th>
                                            <th>Target</th>
                                            <th>Stop Loss</th>
                                            <th>Confidence</th>
                                            <th>Time Frame</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="tradingSignalsBody">
                                        <tr class="table-success">
                                            <td><span class="badge bg-success fs-6">BUY</span></td>
                                            <td><strong>RELIANCE</strong></td>
                                            <td>₹2,845.60</td>
                                            <td>₹3,100.00 (+8.9%)</td>
                                            <td>₹2,650.00 (-6.9%)</td>
                                            <td>
                                                <div class="progress" style="height: 20px;">
                                                    <div class="progress-bar bg-success" style="width: 88%">88%</div>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-warning">Intraday</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-success" onclick="executeTrade('RELIANCE', 'BUY')">
                                                    <i class="fas fa-play me-1"></i>Execute
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary" onclick="viewSignalDetails('RELIANCE')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr class="table-info">
                                            <td><span class="badge bg-info fs-6">SELL</span></td>
                                            <td><strong>BAJFINANCE</strong></td>
                                            <td>₹6,750.45</td>
                                            <td>₹6,200.00 (-8.2%)</td>
                                            <td>₹7,100.00 (+5.2%)</td>
                                            <td>
                                                <div class="progress" style="height: 20px;">
                                                    <div class="progress-bar bg-info" style="width: 75%">75%</div>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-primary">Swing</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-info" onclick="executeTrade('BAJFINANCE', 'SELL')">
                                                    <i class="fas fa-play me-1"></i>Execute
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary" onclick="viewSignalDetails('BAJFINANCE')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                        <tr class="table-warning">
                                            <td><span class="badge bg-warning fs-6">BUY</span></td>
                                            <td><strong>TATAMOTORS</strong></td>
                                            <td>₹925.30</td>
                                            <td>₹1,050.00 (+13.5%)</td>
                                            <td>₹850.00 (-8.1%)</td>
                                            <td>
                                                <div class="progress" style="height: 20px;">
                                                    <div class="progress-bar bg-warning" style="width: 72%">72%</div>
                                                </div>
                                            </td>
                                            <td><span class="badge bg-success">Positional</span></td>
                                            <td>
                                                <button class="btn btn-sm btn-warning" onclick="executeTrade('TATAMOTORS', 'BUY')">
                                                    <i class="fas fa-play me-1"></i>Execute
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary" onclick="viewSignalDetails('TATAMOTORS')">
                                                    <i class="fas fa-eye"></i>
                                                </button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Performance Metrics -->
            <div class="row">
                <div class="col-md-6">
                    <div class="card border-success">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="fas fa-chart-line me-2"></i>Recent Performance</h6>
                        </div>
                        <div class="card-body">
                            <div class="row text-center">
                                <div class="col-4">
                                    <h5 class="text-success">+12.5%</h5>
                                    <small class="text-muted">Today</small>
                                </div>
                                <div class="col-4">
                                    <h5 class="text-success">+28.3%</h5>
                                    <small class="text-muted">This Week</small>
                                </div>
                                <div class="col-4">
                                    <h5 class="text-success">+45.7%</h5>
                                    <small class="text-muted">This Month</small>
                                </div>
                            </div>
                            <hr>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Winning Trades</span>
                                    <span class="fw-bold">41/50</span>
                                </div>
                                <div class="progress" style="height: 8px;">
                                    <div class="progress-bar bg-success" style="width: 82%"></div>
                                </div>
                            </div>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Average Profit</span>
                                    <span class="fw-bold text-success">+6.2%</span>
                                </div>
                            </div>
                            <div class="mb-0">
                                <div class="d-flex justify-content-between">
                                    <span>Risk Score</span>
                                    <span class="fw-bold text-warning">Medium</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-info">
                        <div class="card-header bg-info text-white">
                            <h6 class="mb-0"><i class="fas fa-robot me-2"></i>AI Trading Insights</h6>
                        </div>
                        <div class="card-body">
                            <div class="alert alert-info mb-3">
                                <strong>Market Sentiment:</strong> Bullish<br>
                                <small>AI detects positive momentum in large-cap stocks</small>
                            </div>
                            <h6>Top Performing Sectors</h6>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Technology</span>
                                    <span class="badge bg-success">+8.5%</span>
                                </div>
                            </div>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Banking</span>
                                    <span class="badge bg-success">+6.2%</span>
                                </div>
                            </div>
                            <div class="mb-2">
                                <div class="d-flex justify-content-between">
                                    <span>Energy</span>
                                    <span class="badge bg-warning">+3.1%</span>
                                </div>
                            </div>
                            <hr>
                            <h6>AI Recommendations</h6>
                            <ul class="list-unstyled mb-0">
                                <li class="small mb-1"><i class="fas fa-check text-success me-2"></i>Increase position in IT stocks</li>
                                <li class="small mb-1"><i class="fas fa-check text-success me-2"></i>Consider profit booking in auto sector</li>
                                <li class="small"><i class="fas fa-exclamation text-warning me-2"></i>Monitor global market trends</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Trade Execution Modal -->
<div class="modal fade" id="tradeExecutionModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Execute Trade</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="tradeExecutionBody">
                <!-- Trade execution details will be loaded here -->
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" onclick="confirmTrade()">Confirm Trade</button>
            </div>
        </div>
    </div>
</div>

<script>
function executeAutoTrade() {
    console.log('Executing auto trade...');
    // TODO: Implement auto trade functionality
}

function refreshSignals() {
    console.log('Refreshing trading signals...');
    // TODO: Implement signal refresh functionality
}

function executeTrade(symbol, action) {
    document.getElementById('tradeExecutionBody').innerHTML = `
        <div class="row">
            <div class="col-12">
                <h6>Trade Details</h6>
                <table class="table table-borderless">
                    <tr><td><strong>Symbol:</strong></td><td>${symbol}</td></tr>
                    <tr><td><strong>Action:</strong></td><td><span class="badge bg-${action === 'BUY' ? 'success' : 'danger'}">${action}</span></td></tr>
                    <tr><td><strong>Quantity:</strong></td><td>10 shares</td></tr>
                    <tr><td><strong>Price:</strong></td><td>₹2,845.60</td></tr>
                    <tr><td><strong>Total Value:</strong></td><td>₹28,456</td></tr>
                </table>
            </div>
        </div>
        <div class="alert alert-warning">
            <i class="fas fa-exclamation-triangle me-2"></i>
            Please review the trade details carefully before confirmation.
        </div>
    `;
    new bootstrap.Modal(document.getElementById('tradeExecutionModal')).show();
}

function viewSignalDetails(symbol) {
    console.log('Viewing signal details for:', symbol);
    // TODO: Implement signal details view
}

function confirmTrade() {
    console.log('Confirming trade...');
    // TODO: Implement trade confirmation
    bootstrap.Modal.getInstance(document.getElementById('tradeExecutionModal')).hide();
}

// Auto-refresh signals every 30 seconds
setInterval(refreshSignals, 30000);
</script>

<style>
.card {
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}

.progress {
    border-radius: 10px;
}

.badge {
    font-size: 0.75rem;
    padding: 0.4rem 0.6rem;
}

.table th {
    border-top: none;
    font-weight: 600;
    color: #495057;
    background-color: #f8f9fa;
}

.btn-toolbar .btn-group {
    margin-right: 0.5rem;
}

.table-success {
    background-color: rgba(40, 167, 69, 0.1);
}

.table-info {
    background-color: rgba(23, 162, 184, 0.1);
}

.table-warning {
    background-color: rgba(255, 193, 7, 0.1);
}
</style>
{% endblock %}