<nav class="sidebar bg-dark text-white vh-100 position-fixed">
    <div class="sidebar-header p-3">
        <h4 class="text-center">
            <i class="fas fa-chart-line me-2"></i>tCapital
        </h4>
        <p class="text-center small text-muted mb-0">AI Trading Dashboard</p>
    </div>
    
    <div class="sidebar-content">
        <ul class="nav flex-column">
            <!-- Always available to all users -->
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard' else '' }}" 
                   href="{{ url_for('dashboard') }}">
                    <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                </a>
            </li>
            
            <!-- Trader+ Features (not available to Free users) -->
            {% if current_user.is_authenticated and current_user.can_access_menu('dashboard_trading_signals') %}
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_trading_signals' else '' }}" 
                   href="{{ url_for('dashboard_trading_signals') }}">
                    <i class="fas fa-chart-line me-2"></i>Trading Signals
                </a>
            </li>
            {% else %}
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-chart-line me-2"></i>Trading Signals</span>
                    <i class="fas fa-lock small" title="Upgrade to access"></i>
                </span>
            </li>
            {% endif %}
            
            {% if current_user.is_authenticated and current_user.can_access_menu('dashboard_stock_picker') %}
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_stock_picker' else '' }}" 
                   href="{{ url_for('dashboard_stock_picker') }}">
                    <i class="fas fa-search me-2"></i>Stock Picker
                </a>
            </li>
            {% else %}
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-search me-2"></i>Stock Picker</span>
                    <i class="fas fa-lock small" title="Upgrade to access"></i>
                </span>
            </li>
            {% endif %}
            
            <!-- Stock Analysis menu removed - charts now work everywhere stocks/indices are displayed -->
            
            {% if current_user.is_authenticated and current_user.can_access_menu('dashboard_my_portfolio') %}
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_my_portfolio' else '' }}" 
                   href="{{ url_for('dashboard_my_portfolio') }}">
                    <i class="fas fa-briefcase me-2"></i>My Portfolio
                </a>
            </li>
            {% else %}
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-briefcase me-2"></i>My Portfolio</span>
                    <i class="fas fa-lock small" title="Upgrade to access"></i>
                </span>
            </li>
            {% endif %}
            
            <!-- Premium Feature - Trade Now (only Trader & Premium) -->
            {% if current_user.is_authenticated and current_user.can_access_menu('dashboard_trade_now') %}
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_trade_now' else '' }}" 
                   href="{{ url_for('dashboard_trade_now') }}">
                    <i class="fas fa-bolt me-2"></i>Trade Now
                </a>
            </li>
            {% else %}
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-bolt me-2"></i>Trade Now</span>
                    <i class="fas fa-crown small text-warning" title="Premium feature"></i>
                </span>
            </li>
            {% endif %}
            
            <!-- Broker Accounts (Trader Plus & Premium only) -->
            {% if current_user.is_authenticated and current_user.can_access_menu('dashboard_broker_accounts') %}
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_broker_accounts' else '' }}" 
                   href="{{ url_for('dashboard_broker_accounts') }}">
                    <i class="fas fa-link me-2"></i>Broker Accounts
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_live_portfolio' else '' }}" 
                   href="{{ url_for('dashboard_live_portfolio') }}">
                    <i class="fas fa-chart-area me-2"></i>Live Portfolio
                </a>
            </li>
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_broker_trading' else '' }}" 
                   href="{{ url_for('dashboard_broker_trading') }}">
                    <i class="fas fa-bolt me-2"></i>Live Trading
                </a>
            </li>
            {% else %}
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-link me-2"></i>Broker Accounts</span>
                    <i class="fas fa-crown small text-warning" title="Premium feature"></i>
                </span>
            </li>
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-chart-area me-2"></i>Live Portfolio</span>
                    <i class="fas fa-crown small text-warning" title="Premium feature"></i>
                </span>
            </li>
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-bolt me-2"></i>Live Trading</span>
                    <i class="fas fa-crown small text-warning" title="Premium feature"></i>
                </span>
            </li>
            {% endif %}
            
            {% if current_user.is_authenticated and current_user.can_access_menu('dashboard_account_handling') %}
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'dashboard_account_handling' else '' }}" 
                   href="{{ url_for('dashboard_account_handling') }}">
                    <i class="fas fa-user-cog me-2"></i>Account Handling
                </a>
            </li>
            {% else %}
            <li class="nav-item">
                <span class="nav-link text-muted d-flex justify-content-between align-items-center">
                    <span><i class="fas fa-user-cog me-2"></i>Account Handling</span>
                    <i class="fas fa-lock small" title="Upgrade to access"></i>
                </span>
            </li>
            {% endif %}
            
            <li class="nav-item">
                <a class="nav-link text-white {{ 'active' if request.endpoint == 'ai_advisor' else '' }}" 
                   href="{{ url_for('ai_advisor') }}">
                    <i class="fas fa-robot me-2"></i>AI Advisor
                </a>
            </li>

        </ul>
        
        <!-- Broker Status -->
        <div class="mt-4 p-3 border-top border-secondary">
            <h6 class="text-white small">
                <a href="{{ url_for('broker_management') }}" class="text-white text-decoration-none">
                    Broker Status <i class="fas fa-external-link-alt ms-1 small"></i>
                </a>
            </h6>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small">Zerodha</span>
                <span class="badge bg-success">Connected</span>
            </div>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small">Dhan</span>
                <span class="badge bg-success">Connected</span>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <span class="small">Angel One</span>
                <span class="badge bg-secondary">Disconnected</span>
            </div>
        </div>
        
        <!-- AI Status -->
        <!-- User Plan Status -->
        {% if current_user.is_authenticated %}
        <div class="mt-3 p-3 border-top border-secondary">
            <h6 class="text-white small">
                <i class="fas fa-user-crown me-1"></i>Current Plan
            </h6>
            <div class="d-flex justify-content-between align-items-center mb-2">
                <span class="small text-white">{{ current_user.get_plan_display_name() }}</span>
                {% if current_user.pricing_plan.value == 'free' %}
                <span class="badge bg-secondary">Free</span>
                {% elif current_user.pricing_plan.value == 'trader' %}
                <span class="badge bg-primary">Trader</span>
                {% elif current_user.pricing_plan.value == 'trader_plus' %}
                <span class="badge bg-warning">Trader+</span>
                {% else %}
                <span class="badge bg-success">Premium</span>
                {% endif %}
            </div>
            {% if current_user.pricing_plan.value == 'free' %}
            <a href="{{ url_for('pricing') }}" class="btn btn-sm btn-outline-warning w-100">
                <i class="fas fa-arrow-up me-1"></i>Upgrade Plan
            </a>
            {% endif %}
        </div>
        {% endif %}
        
        <!-- AI Status -->
        <div class="mt-3 p-3 border-top border-secondary">
            <h6 class="text-muted small">AI Status</h6>
            <div class="d-flex align-items-center">
                <div class="spinner-grow spinner-grow-sm text-success me-2" role="status">
                    <span class="visually-hidden">Loading...</span>
                </div>
                <span class="small">Agentic AI Active</span>
            </div>
            <small class="text-muted">Monitoring 245 stocks</small>
        </div>
    </div>
</nav>

<style>
.sidebar {
    width: 280px;
    background: linear-gradient(180deg, #00091a 0%, #1a1a2e 100%);
    border-right: 1px solid #495057;
    z-index: 1000;
}

.sidebar .nav-link {
    padding: 12px 20px;
    border-radius: 8px;
    margin: 2px 15px;
    transition: all 0.3s ease;
}

.sidebar .nav-link:hover {
    background-color: rgba(255, 255, 255, 0.1);
    transform: translateX(5px);
}

.sidebar .nav-link.active {
    background-color: #007bff;
    color: white !important;
}

.sidebar .nav-link i {
    width: 20px;
    text-align: center;
}

.badge {
    font-size: 0.7rem;
}

@media (max-width: 768px) {
    .sidebar {
        width: 100%;
        height: auto;
        position: relative;
    }
}
</style>