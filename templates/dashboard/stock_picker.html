{% extends "base.html" %}

{% block title %}Stock Picker - tCapital Dashboard{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row">
        <!-- Sidebar -->
        <div class="col-md-3 col-lg-2 px-0">
            {% include 'dashboard/sidebar.html' %}
        </div>
        
        <!-- Main Content -->
        <div class="col-md-9 col-lg-10">
            <div class="d-flex justify-content-between flex-wrap flex-md-nowrap align-items-center pt-3 pb-2 mb-3 border-bottom">
                <h1 class="h2"><i class="fas fa-search me-2"></i>AI Stock Picker</h1>
                <div class="btn-toolbar mb-2 mb-md-0">
                    <div class="btn-group me-2">
                        <button type="button" class="btn btn-primary btn-sm" onclick="generateAIRecommendations()">
                            <i class="fas fa-robot me-1"></i>Generate AI Picks
                        </button>
                    </div>
                </div>
            </div>

            <!-- AI Research Controls -->
            <div class="row mb-4">
                <div class="col-md-12">
                    <div class="card border-primary">
                        <div class="card-header bg-primary text-white">
                            <h5 class="mb-0"><i class="fas fa-brain me-2"></i>AI Research Engine</h5>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Research Type</label>
                                        <select class="form-select" id="researchType">
                                            <option value="recommendations">Stock Recommendations</option>
                                            <option value="single">Single Stock Analysis</option>
                                            <option value="sector">Sector Analysis</option>
                                            <option value="market">Market Overview</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Investment Strategy</label>
                                        <select class="form-select" id="investmentStrategy">
                                            <option value="growth">Growth Investing</option>
                                            <option value="value">Value Investing</option>
                                            <option value="momentum">Momentum Trading</option>
                                            <option value="dividend">Dividend Investing</option>
                                            <option value="mixed">Mixed Strategy</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Risk Tolerance</label>
                                        <select class="form-select" id="riskTolerance">
                                            <option value="low">Conservative (Low Risk)</option>
                                            <option value="medium">Moderate (Medium Risk)</option>
                                            <option value="high">Aggressive (High Risk)</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Investment Horizon</label>
                                        <select class="form-select" id="investmentHorizon">
                                            <option value="short">Short Term (1-6 months)</option>
                                            <option value="medium">Medium Term (6-18 months)</option>
                                            <option value="long">Long Term (1+ years)</option>
                                        </select>
                                    </div>
                                </div>
                            </div>
                            <div class="row" id="singleStockRow" style="display: none;">
                                <div class="col-md-6">
                                    <div class="mb-3">
                                        <label class="form-label">Stock Symbol</label>
                                        <input type="text" class="form-control" id="stockSymbol" placeholder="Enter stock symbol (e.g., RELIANCE)">
                                    </div>
                                </div>
                            </div>
                            <button type="button" class="btn btn-primary" onclick="startAIResearch()">
                                <i class="fas fa-play me-2"></i>Start AI Research
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Research Loading -->
            <div class="row mb-4" id="researchLoading" style="display: none;">
                <div class="col-md-12">
                    <div class="card border-info">
                        <div class="card-body text-center">
                            <div class="spinner-border text-primary" role="status">
                                <span class="visually-hidden">Researching...</span>
                            </div>
                            <h5 class="mt-3">AI is analyzing market data...</h5>
                            <p class="text-muted">Using advanced algorithms to identify the best investment opportunities</p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Research Results -->
            <div class="row" id="researchResults" style="display: none;">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-chart-line me-2"></i>AI Research Results</h5>
                            <span class="badge bg-success">Generated by Agentic AI</span>
                        </div>
                        <div class="card-body" id="researchResultsBody">
                            <!-- Results will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- Top AI Picks -->
            <div class="row mt-4">
                <div class="col-md-12">
                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h5 class="mb-0"><i class="fas fa-star me-2"></i>Today's Top AI Picks</h5>
                            <span class="badge bg-warning">Updated 15 mins ago</span>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <div class="card border-success h-100">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h6 class="card-title">RELIANCE</h6>
                                                    <p class="text-muted small">Reliance Industries</p>
                                                    <h5 class="text-success">₹2,845.60</h5>
                                                    <span class="badge bg-success">BUY</span>
                                                </div>
                                                <div class="text-end">
                                                    <div class="progress mb-2" style="height: 8px; width: 60px;">
                                                        <div class="progress-bar bg-success" style="width: 92%"></div>
                                                    </div>
                                                    <small class="text-muted">92% Confidence</small>
                                                </div>
                                            </div>
                                            <p class="small mt-2">AI identifies strong fundamentals and positive momentum in the energy sector.</p>
                                            <button class="btn btn-sm btn-outline-primary w-100" onclick="viewDetailedAnalysis('RELIANCE')">
                                                View Analysis
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card border-info h-100">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h6 class="card-title">INFY</h6>
                                                    <p class="text-muted small">Infosys Limited</p>
                                                    <h5 class="text-info">₹1,485.30</h5>
                                                    <span class="badge bg-info">HOLD</span>
                                                </div>
                                                <div class="text-end">
                                                    <div class="progress mb-2" style="height: 8px; width: 60px;">
                                                        <div class="progress-bar bg-info" style="width: 78%"></div>
                                                    </div>
                                                    <small class="text-muted">78% Confidence</small>
                                                </div>
                                            </div>
                                            <p class="small mt-2">Stable IT giant with consistent performance and strong client base.</p>
                                            <button class="btn btn-sm btn-outline-primary w-100" onclick="viewDetailedAnalysis('INFY')">
                                                View Analysis
                                            </button>
                                        </div>
                                    </div>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <div class="card border-warning h-100">
                                        <div class="card-body">
                                            <div class="d-flex justify-content-between align-items-start">
                                                <div>
                                                    <h6 class="card-title">BAJFINANCE</h6>
                                                    <p class="text-muted small">Bajaj Finance</p>
                                                    <h5 class="text-warning">₹6,750.45</h5>
                                                    <span class="badge bg-warning">WATCH</span>
                                                </div>
                                                <div class="text-end">
                                                    <div class="progress mb-2" style="height: 8px; width: 60px;">
                                                        <div class="progress-bar bg-warning" style="width: 65%"></div>
                                                    </div>
                                                    <small class="text-muted">65% Confidence</small>
                                                </div>
                                            </div>
                                            <p class="small mt-2">NBFC leader with growth potential but regulatory concerns to monitor.</p>
                                            <button class="btn btn-sm btn-outline-primary w-100" onclick="viewDetailedAnalysis('BAJFINANCE')">
                                                View Analysis
                                            </button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- AI Insights Summary -->
            <div class="row mt-4">
                <div class="col-md-6">
                    <div class="card border-success">
                        <div class="card-header bg-success text-white">
                            <h6 class="mb-0"><i class="fas fa-thumbs-up me-2"></i>Market Opportunities</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled mb-0">
                                <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Energy sector showing strong momentum</li>
                                <li class="mb-2"><i class="fas fa-check text-success me-2"></i>IT stocks at attractive valuations</li>
                                <li class="mb-2"><i class="fas fa-check text-success me-2"></i>Banking sector consolidation benefits</li>
                                <li class="mb-0"><i class="fas fa-check text-success me-2"></i>Infrastructure spending boost expected</li>
                            </ul>
                        </div>
                    </div>
                </div>
                <div class="col-md-6">
                    <div class="card border-danger">
                        <div class="card-header bg-danger text-white">
                            <h6 class="mb-0"><i class="fas fa-exclamation-triangle me-2"></i>Risk Factors</h6>
                        </div>
                        <div class="card-body">
                            <ul class="list-unstyled mb-0">
                                <li class="mb-2"><i class="fas fa-exclamation text-danger me-2"></i>Global inflation concerns</li>
                                <li class="mb-2"><i class="fas fa-exclamation text-danger me-2"></i>Regulatory changes in fintech</li>
                                <li class="mb-2"><i class="fas fa-exclamation text-danger me-2"></i>Currency volatility impact</li>
                                <li class="mb-0"><i class="fas fa-exclamation text-danger me-2"></i>Geopolitical tensions</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Detailed Analysis Modal -->
<div class="modal fade" id="detailedAnalysisModal" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog modal-xl">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Detailed Stock Analysis</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="detailedAnalysisBody">
                <!-- Detailed analysis will be loaded here -->
            </div>
        </div>
    </div>
</div>

<script>
// Show/hide single stock input based on research type
document.getElementById('researchType').addEventListener('change', function() {
    const singleStockRow = document.getElementById('singleStockRow');
    if (this.value === 'single') {
        singleStockRow.style.display = 'block';
    } else {
        singleStockRow.style.display = 'none';
    }
});

function generateAIRecommendations() {
    console.log('Generating AI recommendations...');
    // TODO: Implement AI recommendation generation
}

function startAIResearch() {
    const researchType = document.getElementById('researchType').value;
    const strategy = document.getElementById('investmentStrategy').value;
    const risk = document.getElementById('riskTolerance').value;
    const horizon = document.getElementById('investmentHorizon').value;
    
    // Show loading
    document.getElementById('researchLoading').style.display = 'block';
    document.getElementById('researchResults').style.display = 'none';
    
    // Simulate AI research process
    setTimeout(() => {
        document.getElementById('researchLoading').style.display = 'none';
        document.getElementById('researchResults').style.display = 'block';
        
        // Display mock results
        document.getElementById('researchResultsBody').innerHTML = `
            <div class="row">
                <div class="col-md-12">
                    <h6>Research Summary</h6>
                    <p>Based on your ${strategy} strategy with ${risk} risk tolerance for ${horizon} investment horizon, our AI has identified the following opportunities:</p>
                    
                    <div class="alert alert-info">
                        <strong>AI Insight:</strong> Current market conditions favor ${strategy} approach with emphasis on fundamentally strong companies in growth sectors.
                    </div>
                    
                    <div class="row mt-3">
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-light rounded">
                                <h5 class="text-primary">12</h5>
                                <p class="mb-0">Stocks Analyzed</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-light rounded">
                                <h5 class="text-success">5</h5>
                                <p class="mb-0">Strong Buys</p>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="text-center p-3 bg-light rounded">
                                <h5 class="text-warning">3</h5>
                                <p class="mb-0">Watch List</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }, 3000);
}

function viewDetailedAnalysis(symbol) {
    document.getElementById('detailedAnalysisBody').innerHTML = `
        <div class="row">
            <div class="col-md-6">
                <h6>Technical Analysis for ${symbol}</h6>
                <div class="mt-3">
                    <canvas id="technicalChart" width="400" height="200"></canvas>
                </div>
                <div class="mt-3">
                    <h6>Key Metrics</h6>
                    <table class="table table-sm">
                        <tr><td>P/E Ratio</td><td>18.5</td></tr>
                        <tr><td>ROE</td><td>15.2%</td></tr>
                        <tr><td>Debt/Equity</td><td>0.45</td></tr>
                        <tr><td>Market Cap</td><td>₹18,50,000 Cr</td></tr>
                    </table>
                </div>
            </div>
            <div class="col-md-6">
                <h6>AI Analysis Summary</h6>
                <div class="alert alert-success">
                    <strong>Recommendation:</strong> Strong Buy
                </div>
                <p>Our AI analysis indicates strong fundamentals with the following key points:</p>
                <ul>
                    <li>Consistent revenue growth over the past 4 quarters</li>
                    <li>Strong balance sheet with low debt levels</li>
                    <li>Positive industry outlook and market positioning</li>
                    <li>Technical indicators suggest upward momentum</li>
                </ul>
                
                <h6 class="mt-4">Risk Assessment</h6>
                <div class="progress mb-2">
                    <div class="progress-bar bg-success" style="width: 75%">Low Risk - 75%</div>
                </div>
                
                <h6 class="mt-3">Price Targets</h6>
                <table class="table table-sm">
                    <tr><td>1 Month</td><td>₹3,050</td></tr>
                    <tr><td>3 Months</td><td>₹3,200</td></tr>
                    <tr><td>6 Months</td><td>₹3,400</td></tr>
                </table>
            </div>
        </div>
    `;
    new bootstrap.Modal(document.getElementById('detailedAnalysisModal')).show();
}
</script>

<style>
.card {
    border-radius: 10px;
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transition: transform 0.2s;
}

.card:hover {
    transform: translateY(-2px);
}

.progress {
    border-radius: 10px;
}

.badge {
    font-size: 0.75rem;
    padding: 0.4rem 0.6rem;
}

.btn-toolbar .btn-group {
    margin-right: 0.5rem;
}

.border-success .card-body, .border-info .card-body, .border-warning .card-body {
    border-left: 4px solid;
}

.border-success .card-body {
    border-left-color: #28a745;
}

.border-info .card-body {
    border-left-color: #17a2b8;
}

.border-warning .card-body {
    border-left-color: #ffc107;
}
</style>
{% endblock %}