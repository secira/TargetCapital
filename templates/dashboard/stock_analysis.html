{% extends "base.html" %}

{% block title %}Stock Analysis - tCapital{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="bg-white text-dark border-bottom py-4">
    <div class="container">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="h3 mb-1">Stock Analysis</h1>
                <p class="mb-0 opacity-75">AI-powered market insights and recommendations</p>
            </div>
            <div class="col-md-4 text-md-end">
                <a href="{{ url_for('dashboard') }}" class="btn btn-outline-primary btn-sm">
                    <i class="fas fa-arrow-left me-1"></i>Back to Dashboard
                </a>
            </div>
        </div>
    </div>
</div>

<div class="container py-4">
    <!-- Analysis Tools -->
    <div class="row mb-4">
        <div class="col-lg-8">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-search text-primary me-2"></i>Stock Analyzer
                    </h5>
                </div>
                <div class="card-body">
                    <form class="row g-3">
                        <div class="col-md-4">
                            <label for="analyzeSymbol" class="form-label">Stock Symbol</label>
                            <input type="text" class="form-control" id="analyzeSymbol" placeholder="e.g., AAPL">
                        </div>
                        <div class="col-md-4">
                            <label for="analysisType" class="form-label">Analysis Type</label>
                            <select class="form-select" id="analysisType">
                                <option selected>Technical Analysis</option>
                                <option>Fundamental Analysis</option>
                                <option>AI Sentiment Analysis</option>
                                <option>Risk Assessment</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">&nbsp;</label>
                            <button type="button" class="btn btn-primary w-100" onclick="analyzeStock()">
                                <i class="fas fa-chart-line me-2"></i>Analyze
                            </button>
                        </div>
                    </form>
                    
                    <!-- Analysis Results Placeholder -->
                    <div id="analysisResults" class="mt-4" style="display: none;">
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle me-2"></i>
                            <strong>Demo Mode:</strong> This is a demonstration interface. In production, this would connect to real-time market data APIs.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-lg-4">
            <div class="card shadow-sm">
                <div class="card-header bg-white">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-robot text-success me-2"></i>AI Insights
                    </h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <h6 class="fw-bold text-success">Market Outlook</h6>
                        <p class="small text-muted mb-2">Bullish sentiment detected in tech sector</p>
                    </div>
                    <div class="mb-3">
                        <h6 class="fw-bold text-warning">Risk Alert</h6>
                        <p class="small text-muted mb-2">Increased volatility expected this week</p>
                    </div>
                    <div class="mb-3">
                        <h6 class="fw-bold text-info">Opportunity</h6>
                        <p class="small text-muted mb-2">AI and cloud stocks showing momentum</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Analyses -->
    <div class="card shadow-sm">
        <div class="card-header bg-white d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">
                <i class="fas fa-history text-info me-2"></i>Recent Analyses
            </h5>
            <button class="btn btn-outline-primary btn-sm" onclick="refreshAnalyses()">
                <i class="fas fa-sync-alt me-1"></i>Refresh
            </button>
        </div>
        <div class="card-body">
            {% if analyses %}
                <div class="table-responsive">
                    <table class="table table-hover">
                        <thead>
                            <tr>
                                <th>Symbol</th>
                                <th>Company</th>
                                <th>Current Price</th>
                                <th>Change</th>
                                <th>AI Recommendation</th>
                                <th>Confidence</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for analysis in analyses %}
                            <tr>
                                <td><span class="badge bg-primary">{{ analysis.symbol }}</span></td>
                                <td>
                                    <div class="fw-bold">{{ analysis.company_name }}</div>
                                </td>
                                <td class="fw-bold">${{ "%.2f"|format(analysis.current_price) }}</td>
                                <td>
                                    <span class="text-{{ 'success' if analysis.change_amount > 0 else 'danger' }}">
                                        <i class="fas fa-arrow-{{ 'up' if analysis.change_amount > 0 else 'down' }} me-1"></i>
                                        {{ "%.2f"|format(analysis.change_percent) }}%
                                    </span>
                                </td>
                                <td>
                                    {% if analysis.ai_recommendation %}
                                        <span class="badge bg-{{ 'success' if analysis.ai_recommendation == 'BUY' else 'warning' if analysis.ai_recommendation == 'HOLD' else 'danger' }}">
                                            {{ analysis.ai_recommendation }}
                                        </span>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    {% if analysis.ai_confidence %}
                                        <div class="progress" style="height: 20px;">
                                            <div class="progress-bar bg-{{ 'success' if analysis.ai_confidence > 70 else 'warning' if analysis.ai_confidence > 40 else 'danger' }}" 
                                                 role="progressbar" 
                                                 style="width: {{ analysis.ai_confidence }}%">
                                                {{ "%.0f"|format(analysis.ai_confidence) }}%
                                            </div>
                                        </div>
                                    {% else %}
                                        <span class="text-muted">-</span>
                                    {% endif %}
                                </td>
                                <td>
                                    <small class="text-muted">{{ analysis.analysis_date.strftime('%m/%d/%Y') }}</small>
                                </td>
                                <td>
                                    <div class="btn-group btn-group-sm">
                                        <button class="btn btn-outline-info" onclick="viewAnalysis('{{ analysis.id }}')">
                                            <i class="fas fa-eye"></i>
                                        </button>
                                        <button class="btn btn-outline-primary" onclick="addToWatchlist('{{ analysis.symbol }}', '{{ analysis.company_name }}')">
                                            <i class="fas fa-plus"></i>
                                        </button>
                                    </div>
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            {% else %}
                <div class="text-center py-5">
                    <i class="fas fa-chart-line fa-4x text-muted mb-4"></i>
                    <h4 class="text-muted">No analyses available</h4>
                    <p class="text-muted mb-4">Start analyzing stocks using the tool above.</p>
                    
                    <div class="row justify-content-center">
                        <div class="col-md-8">
                            <h6 class="fw-bold mb-3">Popular Stocks to Analyze:</h6>
                            <div class="d-flex flex-wrap gap-2 justify-content-center">
                                <button class="btn btn-outline-primary btn-sm" onclick="quickAnalyze('AAPL')">AAPL</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="quickAnalyze('GOOGL')">GOOGL</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="quickAnalyze('MSFT')">MSFT</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="quickAnalyze('TSLA')">TSLA</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="quickAnalyze('NVDA')">NVDA</button>
                                <button class="btn btn-outline-primary btn-sm" onclick="quickAnalyze('AMZN')">AMZN</button>
                            </div>
                        </div>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
</div>

<style>
.bg-light {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}
</style>

<script>
function analyzeStock() {
    const symbol = document.getElementById('analyzeSymbol').value;
    const analysisType = document.getElementById('analysisType').value;
    
    if (!symbol) {
        alert('Please enter a stock symbol');
        return;
    }
    
    // Show demo results
    const resultsDiv = document.getElementById('analysisResults');
    resultsDiv.innerHTML = `
        <div class="alert alert-info">
            <i class="fas fa-info-circle me-2"></i>
            <strong>Demo Analysis for ${symbol.toUpperCase()}</strong><br>
            Analysis Type: ${analysisType}<br>
            <small>In production, this would show real-time analysis results.</small>
        </div>
    `;
    resultsDiv.style.display = 'block';
}

function quickAnalyze(symbol) {
    document.getElementById('analyzeSymbol').value = symbol;
    analyzeStock();
}

function viewAnalysis(id) {
    alert('View detailed analysis for ID: ' + id + '\n\nThis would open a detailed analysis modal or page.');
}

function addToWatchlist(symbol, company) {
    if (confirm(`Add ${symbol} (${company}) to your watchlist?`)) {
        // In production, this would make an AJAX call
        alert(`${symbol} would be added to your watchlist`);
    }
}

function refreshAnalyses() {
    // In production, this would reload the analyses
    alert('Analyses refreshed!\n\nIn production, this would reload the latest market data.');
}
</script>
{% endblock %}